<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>test python fast api</title>
</head>
<body>
    
    <div class="header">
        <h2>Site Header</h2>
    </div>
    <div class="content">
        <button onclick="showUsers()">Show Users</button>
        <div class="listUsers">
            <ul id="ulOfUsers"></ul>
        </div>
        <div class="findUser">
            <input type="number" name="findId" id="findId" oninput="findUser()">
            <span id="userIdField"></span>
        </div>
        <form>
            <input type="number" name="changeId" id="changeId">
            <input type="text" name="changeName" id="changeName">
            <input type="text" name="changeLastname" id="changeLastname">
            <button type="button" id="changeForm">Change</button>
        </form>
    </div>
    <div class="footer">
        <h2>Site Footer</h2>
    </div>

    <script>

        document.getElementById('changeForm').addEventListener('click', changeUser)

        async function showUsers() {
            lis = []
            fetch(
                '/api/users', {
                    method: 'GET', 
                    headers: {'Content-Type': 'application/json'}}
                ).then(async (response) => {
                    response = await response.json()
                    for (user of response) {
                        console.log(user)
                        lis.push(`<li>id: ${user.id}, lastname: ${user.lastname}, name: ${user.name}</li>`)
                    }
                    
                    ulOfUsers = document.getElementById('ulOfUsers')
                    ulOfUsers.innerHTML = lis.join('')
                })
        }

        async function findUser() {
            id = document.getElementById('findId').value
            findIdSpan = document.getElementById('userIdField')
            fetch(
                `/api/users/${id}`, {
                    method: 'GET', 
                    headers: {'Content-Type': 'application/json'}
                }
            ).then(async (response) => {
                res = await response.json()
                if (res.id && res.name && res.lastname) {
                    findIdSpan.innerHTML = `id: ${res.id}, lastname: ${res.lastname}, name: ${res.name}`
                } else findIdSpan.innerHTML = 'User not found'
            })
        }

        async function changeUser() {
            userid = document.getElementById('changeId').value
            username = document.getElementById('changeName').value
            userlastname = document.getElementById('changeLastname').value
            fetch('api/users', {
                method: 'put',
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    id: userid,
                    name: username,
                    lastname: userlastname
                })
            }).then(async (response) => {
                res = await response.json()
                console.log(res)
            })
        }

    </script>

</body>
</html>